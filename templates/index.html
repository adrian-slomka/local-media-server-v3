<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Stream Movies & TV Shows</title>
    <script src="{{ url_for('static', filename='js/api/_token.js') }}"></script>
</head>
<body>
    <div class="app-layout">        
        <div class="app-layout__header">
            <div class="header-container header-container__mobile">
                <div class="actions">
                    <a href="/logout" class="profile-link">
                        <div class="header-profile">
                            <img id="profile-picture" src="/static/images/profiles/default_profile.jpg">
                        </div>
                    </a>
                    <div class="profile-title">
                        <p>Hello,</p>
                        <h4 id="profile-name">⠀</h4>
                    </div>
                </div>

                <div class="header-internal-links" id="re-scan-btn">
                    <!--  -->
                </div>
            </div>
        </div>
        <div class="app-layout__content">
            <div class="container">
                <div class="nav nav-font-mobile --padding-nav">
                    <div class="nav-t --highlight" id="featured">Your Feed</div>
                    <div class="nav-t" id="browse">Browse</div>
                    <!-- <div class="nav-t" id="watchlist">My List</div> -->
                    <div class="nav-t" id="search">Search</div>
                </div>
                <div class="hero-section --padding-bottom-5rem" id="hero" style="display:none;">
                    <div class="scroller-container">
                        <div class="content-wrapper scroller" id="hero-sl"></div>               
                        <div class="scroller-controls">
                            <div class="actions-dots" id="hero-dots"></div>
                        </div>
                    </div>
                </div>
                <div class="tab " id="feat-tab">
                    <div class="dynamic-feed">
                        <div class="carousel-wrapper" data-t="user-feed">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header-container">
                                    <div class="feed-header__title --light-font-h2">
                                        <h2>Recently updated from Your watchlist</h2>
                                    </div>
                                    <div class="feed-header__arrows">
                                        <div id="arrow-left" class="arrow-button-l">←</div>
                                        <div id="arrow-right" class="arrow-button-r">→</div>
                                    </div>
                                </div>
                                <!-- <a class="feed-header__link --cursor-pointer" href="/">
                                    <p>See all</p>
                                </a> -->
                            </div>
                            <div class="">
                                <div class="wide-cards-carousel content-wrapper" id="user-new">
                                    <!-- JS insert -->
                                    <a href="" class="poster__placeholder">
                                        <img src="" alt="">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="" data-t="user-playlist">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header__title --light-font-h2">
                                    <h2>Collections</h2>
                                </div>
                            </div>
                        </div>  
                        <div class="" data-t="user-stats">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header__title --light-font-h2">
                                    <h2>My Stats</h2>
                                </div>
                            </div>
                        </div>                         -->
                    </div>
                </div>
                <div class="tab --disabled" id="browse-tab">
                    <div class="dynamic-feed">
                        <div class="carousel-wrapper" data-t="new">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header-container">
                                    <div class="feed-header__title --light-font-h2">
                                        <h2>Recently Updated</h2>
                                    </div>
                                    <div class="feed-header__arrows">
                                        <div id="arrow-left" class="arrow-button-l">←</div>
                                        <div id="arrow-right" class="arrow-button-r">→</div>
                                    </div>
                                </div>
                                <a class="feed-header__link --cursor-pointer" href="/browse">
                                    <p>See all</p>
                                </a>
                            </div>
                            <div class="">
                                <div class="wide-cards-carousel content-wrapper" id="new-carousel">
                                    <!-- JS insert -->
                                    <a href="" class="poster__placeholder">
                                        <img src="" alt="">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-wrapper" data-t="tv">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header-container">
                                    <div class="feed-header__title --light-font-h2">
                                        <h2>TV Show</h2>
                                    </div>
                                    <div class="feed-header__arrows">
                                        <div id="arrow-left" class="arrow-button-l">←</div>
                                        <div id="arrow-right" class="arrow-button-r">→</div>
                                    </div>
                                </div>
                                <a class="feed-header__link --cursor-pointer" href="/browse">
                                    <p>See all</p>
                                </a>
                            </div>
                            <div class="">
                                <div class="wide-cards-carousel content-wrapper" id="tv-carousel">
                                    <!-- JS insert -->
                                    <a href="" class="poster__placeholder">
                                        <img src="" alt="">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="carousel-wrapper" data-t="movie">
                            <div class="content-wrapper feed-header feed-font-mobile">
                                <div class="feed-header-container">
                                    <div class="feed-header__title --light-font-h2">
                                        <h2>Movie</h2>
                                    </div>
                                    <div class="feed-header__arrows">
                                        <div id="arrow-left" class="arrow-button-l">←</div>
                                        <div id="arrow-right" class="arrow-button-r">→</div>
                                    </div>
                                </div>
                                <a class="feed-header__link --cursor-pointer" href="/browse">
                                    <p>See all</p>
                                </a>
                            </div>
                            <div class="">
                                <div class="wide-cards-carousel content-wrapper" id="movie-carousel">
                                    <!-- JS insert -->
                                    <a href="" class="poster__placeholder">
                                        <img src="" alt="">
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="tab --disabled" id="watchlist-tab">
                </div> -->
                <div class="tab --disabled" id="search-tab">
                    <div class="search-container">
                        <input class="search" type="text" id="search-item" placeholder="Search..." placeholder="Search...">
                    </div>
                    <div class="results-container content-wrapper" id="search-results"></div>
                </div>              
            </div>
        </div>
        <div class="app-layout_footer">
            <div class="footer">
                <div class="footer-line"></div> 
                <br>
                <p style="font-size: 2rem;">-</p>
            </div>            
        </div>
    </div>


<script type="module" src="{{ url_for('static', filename='js/api/_api.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/userProfile.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/userFeed.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/pages/homePage.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/pages/searchPage.js') }}"></script>

<script src="{{ url_for('static', filename='js/components/tabsToggle.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/stickyHeader.js') }}"></script>
<script src="{{ url_for('static', filename='js/components/carouselScroller.js') }}"></script>

<script>
    const isAdmin = {{ session.get('is_admin') | tojson }};
    if (isAdmin) {
        const container = document.getElementById("re-scan-btn");
        const btn = document.createElement("button");
        btn.textContent = "update library";
        btn.id = "rescan-button";
        btn.style.fontSize = "2rem";
        btn.style.padding = "10px 20px";
        btn.style.cursor = "pointer";
        btn.style.background = "transparent";
        btn.style.border = "2px solid #4b42339f"
        btn.style.borderRadius = "15px"
        btn.style.color = "#c0ad9c"
    
        btn.addEventListener("click", async () => {
            try {
                const response = await fetch("/rescan", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                console.log("Endpoint response:", data);
                alert("Re-scan triggered.");
            } catch (err) {
                console.error("Error triggering endpoint:", err);
                alert("Failed to trigger re-scan.");
            }
        });
    
        container.appendChild(btn);
    }
</script>
</body>
</html>